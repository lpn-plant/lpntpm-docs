
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://lpntpm.lpnplant.io/Softcore-CPU/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.14">
    
    
      
        <title>Analysis of the TPM project launch on SoftCore-CPU - lpnTPM Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#analysis-of-the-tpm-project-launch-on-softcore-cpu" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="lpnTPM Documentation" class="md-header__button md-logo" aria-label="lpnTPM Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            lpnTPM Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Analysis of the TPM project launch on SoftCore-CPU
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="lpnTPM Documentation" class="md-nav__button md-logo" aria-label="lpnTPM Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    lpnTPM Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          How to
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          How to
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../how_to/" class="md-nav__link">
        Intro
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../building/" class="md-nav__link">
        Building flashing and debugging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../running/" class="md-nav__link">
        Running
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../instrumentation/" class="md-nav__link">
        TPM driver instrumentation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../hardware_interfaces/" class="md-nav__link">
        Target TPM hardware interfaces
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../symbiflow_investigation/" class="md-nav__link">
        Open-source tools for FPGA synthesis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../issues/" class="md-nav__link">
        Current issues
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Mechanical design
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Mechanical design
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tpm_modules_pinout/" class="md-nav__link">
        TPM modules pinout
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tpm_renders/" class="md-nav__link">
        TPM modules renders
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../journal/" class="md-nav__link">
        Journal
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          RaspberryPi demonstration with TPM module
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          RaspberryPi demonstration with TPM module
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_connection/" class="md-nav__link">
        Connecting Raspberry Pi with Windows OS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi/" class="md-nav__link">
        Running TPM 2.0 module on Raspberry Pi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../sparkfun-thingplus/" class="md-nav__link">
        Development on SparkFun Thing+
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../further_project_development/" class="md-nav__link">
        Considerations on hardware replacement
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tpm_lpc_spi_interface/" class="md-nav__link">
        TPM hardware interface documentation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tpm-spi-dev/" class="md-nav__link">
        SPI interface - implementation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tpm-spi-dump/" class="md-nav__link">
        SPI communication dump
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../TPM_with_LPC_protocol/" class="md-nav__link">
        LPC driver - implementation
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#advantages" class="md-nav__link">
    Advantages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#disadvantages" class="md-nav__link">
    Disadvantages
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#softcore-cpu-selection-criteria" class="md-nav__link">
    SoftCore-CPU selection criteria
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#neorv32" class="md-nav__link">
    NEORV32
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launching-neorv32" class="md-nav__link">
    Launching NEORV32
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="analysis-of-the-tpm-project-launch-on-softcore-cpu">Analysis of the TPM project launch on SoftCore-CPU</h1>
<p>An alternative to hardware Hard-CPU (Or SoC containing Hard-CPU) is
SoftCore-CPU implemented from FPGA programmable circuit resources. This
solution, like any other, has its advantages, but also disadvantages - we will
try to describe them in this short document.</p>
<h2 id="advantages">Advantages</h2>
<p>The main advantage of using SoftCore-CPU is its flexibility. We are able to
"sew" our CPU as needed, adding or omitting the appropriate blocks with HDL code
during synthesis. For example, if we don't need floating point calculations we
can omit FPU unit. For a further example if we need fast calculating checksums
we can add extension with hardware calculating of checksums (implemented in FPGA
fabric). By incurring programming costs, we can extend the set of peripheral
systems of such SoftCore-CPU. Another advantage is the possibility of
implementing SoftCore-CPU in a standard FPGA chip without Hard-CPU.</p>
<h2 id="disadvantages">Disadvantages</h2>
<p>One of the main disadvantages is the lower performance of SoftCore-CPUs than
Hard-CPU. The SoftCore-CPU's main clock frequency is usually just a bit over 100
MHz. Also, the occupancy of both basic FPGA blocks, such as LUTs and Flip-Flops,
or more advanced ones, such as BRAM memory blocks or DSP blocks, is large.
Requirements for more complex SoftCore-CPUs can exceed 30K LUTs and several
thousand FFs. Therefore, it is necessary to select a large FPGA chip to
implement such a solution. The FPGA chip selected to implement SoftCore-CPU must
also be relatively fast.</p>
<p>There are also other limitations related to other aspects of the SoftCore-CPU
design. Often in SoftCore-CPU external RAM memory drivers are not implemented
(for example for DDR memory). There are also often limitations in some
programming tools for such SoftCore-CPU, such as bootloader or C/C++ compiler.</p>
<h2 id="softcore-cpu-selection-criteria">SoftCore-CPU selection criteria</h2>
<p>The SoftCore-CPU selection criteria for the hardware design of the TPM module
have been specified in previous documents - the most important of which are:</p>
<ul>
<li>the existing driver for the external (in relation to FPGA) RAM memory for the
  CPU</li>
<li>The lower limit of the CPU RAM is 256 KB</li>
<li>32-bit high-performance CPU</li>
<li>efficient system bus (preferably with 'burst' mode support)</li>
<li>fast interrupt controller</li>
<li>a big advantage would be a DMA controller with the possibility of transfers
  from BRAM FPGA memory to CPU RAM</li>
<li>flexible configuration options</li>
<li>flexible <code>bootloader</code> with the ability to boot RTOS and/or OS Linux</li>
<li>well-functioning toolchain - C compiler and loader</li>
<li>JTAG debbugger with <code>openOCD</code> support</li>
<li>complete and detailed documentation</li>
<li>sample programs showing how to use various soft-cpu modules</li>
<li>it would be an advantage if SoftCore-CPU could be fully synthesized in open
  source FPGA synthesis tools</li>
</ul>
<h2 id="neorv32">NEORV32</h2>
<p>At this stage of work, we chose SoftCore-CPU named NEORV32 compatible with
32-bit RISC-V ISA. It happened because this project meets most of the
requirements set out in the paragraph above. One of the important factors was
the existing C++ compiler and the ability to debug CPU programs with the JTAG
debugger. The existence of the UART based <code>Bootloader</code> is also important. Also
the documentation for this project seems to be complete. The biggest
disadvantage of this particular SoftCore-CPU is the lack of an external DDR3
memory driver, which will have to be added to this processor. Problematic may
also be that this Soft-CPU was written in VHDL language and most open source
tools only support Verilog.</p>
<p>This project is available at <a href="https://github.com/stnolting/neorv32">GitHub</a>.</p>
<h2 id="launching-neorv32">Launching NEORV32</h2>
<p>To familiarize ourselves with the NEORV32 project, we decided to run it on the
QMTECH FPGA board with the <a href="https://pl.aliexpress.com/item/4000170042795.html?spm=a2g0o.productlist.0.0.50a757860ORVGM&amp;algo_pvid=cda2307e-3949-4ae4-9ca0-1e6c960f5528&amp;algo_exp_id=cda2307e-3949-4ae4-9ca0-1e6c960f5528-0&amp;pdp_ext_f=%7B%22sku_id%22%3A%2212000029897527647%22%7D&amp;pdp_npi=2%40dis%21PLN%21678.02%21678.02%21%21%2141.79%21%21%402100bddd16673770363786889e4a69%2112000029897527647%21sea&amp;curPageLogUid=5KL1GZ3J6SMe">Xilinx Artix-7 chip</a></p>
<p>On the website of the NEORV32 project, there were several configurations for
specific FPGAs from several FPGA manufacturers (Xilinx, Intel, Gowin)
<a href="https://github.com/stnolting/neorv32-setups">NEORV32 Setups</a>
We chose a ready configuration for the Artix-7 FPGA (XC7A100T) because this is
the FPGA chip on the <code>QMTECH</code> development kit <a href="https://github.com/stnolting/neorv32-setups/tree/main/vivado/nexys-a7-test-setup">NEORV32 Setups</a>
In order to create the project NEORV32 in Xilinx Vivado, it was necessary to
clone the project repository (with sub-modules) and use a ready-made script in
the TCL language:</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/stnolting/neorv32-setups.git
git<span class="w"> </span>submodule<span class="w"> </span>init
git<span class="w"> </span>submodule<span class="w"> </span>update
</code></pre></div>
<p>Then you had to go to the subdirectory</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>/&lt;neorv32<span class="w"> </span>dir&gt;/neorv32-setups/vivado/nexys-a7-test-setup
</code></pre></div>
<p>open Xilinx Vivado and in <code>TCL Console</code> issue command</p>
<div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>create_project.tcl
</code></pre></div>
<p>This TCL script created an entire Vivado project for an Artix-7 FPGA chip with
SoftCore-CPU implementation NEORV32 ready for synthesis.
Then we started in Vivado the synthesis, implementation and generation of the
bitstream for the project. Here is a photo of the test circuit:
<img alt="Test Circuit Photo" src="../images/QMTECH_Board.png" /></p>
<p>Synthesis, implementation and generation of FPGA configuration file ended
without errors (there were some warnings):
<img alt="Test Circuit Photo" src="../images/Artix7_NEORV32.png" /></p>
<p>Then, using the JTAG programmer/debugger (<code>Xilinx Cable</code>) we loaded the
configuration file into the FPGA set.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>