
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://lpntpm.lpnplant.io/further_project_development/">
      
      
        <link rel="prev" href="../sparkfun-thingplus/">
      
      
        <link rel="next" href="../tpm_lpc_spi_interface/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.14">
    
    
      
        <title>Considerations on hardware replacement - lpnTPM Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#further-tpm-project-development-investigation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="lpnTPM Documentation" class="md-header__button md-logo" aria-label="lpnTPM Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            lpnTPM Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Considerations on hardware replacement
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="lpnTPM Documentation" class="md-nav__button md-logo" aria-label="lpnTPM Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    lpnTPM Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          How to
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          How to
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../how_to/" class="md-nav__link">
        Intro
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../building/" class="md-nav__link">
        Building flashing and debugging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../running/" class="md-nav__link">
        Running
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../instrumentation/" class="md-nav__link">
        TPM driver instrumentation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../hardware_interfaces/" class="md-nav__link">
        Target TPM hardware interfaces
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../symbiflow_investigation/" class="md-nav__link">
        Open-source tools for FPGA synthesis
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../issues/" class="md-nav__link">
        Current issues
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Mechanical design
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Mechanical design
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tpm_modules_pinout/" class="md-nav__link">
        TPM modules pinout
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tpm_renders/" class="md-nav__link">
        TPM modules renders
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../journal/" class="md-nav__link">
        Journal
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          RaspberryPi demonstration with TPM module
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          RaspberryPi demonstration with TPM module
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_connection/" class="md-nav__link">
        Connecting Raspberry Pi with Windows OS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi/" class="md-nav__link">
        Running TPM 2.0 module on Raspberry Pi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rpi_faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../sparkfun-thingplus/" class="md-nav__link">
        Development on SparkFun Thing+
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Considerations on hardware replacement
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Considerations on hardware replacement
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#current-project-code-analysis-in-terms-of-hardware-dependence" class="md-nav__link">
    Current project code analysis in terms of hardware dependence
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#target-hardware-platform-for-tpm-arm-project" class="md-nav__link">
    Target hardware platform for TPM (ARM) project
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tpm_lpc_spi_interface/" class="md-nav__link">
        TPM hardware interface documentation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tpm-spi-dev/" class="md-nav__link">
        SPI interface - implementation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../tpm-spi-dump/" class="md-nav__link">
        SPI communication dump
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../TPM_with_LPC_protocol/" class="md-nav__link">
        LPC driver - implementation
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#current-project-code-analysis-in-terms-of-hardware-dependence" class="md-nav__link">
    Current project code analysis in terms of hardware dependence
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#target-hardware-platform-for-tpm-arm-project" class="md-nav__link">
    Target hardware platform for TPM (ARM) project
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="further-tpm-project-development-investigation">Further TPM Project development investigation</h1>
<p>If we are going to plan further project development, we have to solve issues
that appears in current work with project. The main issues are:
+ Lack of RAM memory in CPU
+ Rather low frequency of MCU clock</p>
<p>In order to overcome that issues we have to choose more powerful microcontroller.
Planned further implementation of LPC protocol on MCU require higher clock
frequency (above 100 Mhz). In current project static code analysis shows RAM
memory occupancy above 96 percent.</p>
<h2 id="current-project-code-analysis-in-terms-of-hardware-dependence">Current project code analysis in terms of hardware dependence</h2>
<p>We start project code analysis (Nucleo-L476RG) with basic files defining hardware
components.
Catalog "Src" - basic files:</p>
<ol>
<li>system_stm32l4xx.c</li>
</ol>
<p>In this file are defined major hardware parameters: clock frequency, SRAM, FPU.
It can be generated by "STM32CubeMX" software for different MCU model from STM32
family.
2. stm32l4xx_hal_msp.c</p>
<p>In this file is located code for initialisation of hardware modules and peripherals.
It can be generated by "STM32CubeMX" software for different MCU model from STM32
family</p>
<ol>
<li>stm32l4xx_it.c</li>
</ol>
<p>This file includes hardware components and peripherals interrupt handlers routines.
In this file is located code for initialisation of hardware modules and peripherals.
It can be generated by "STM32CubeMX" software for different MCU model from STM32
family.</p>
<ol>
<li>main.c</li>
</ol>
<p>This file is application starter and includes also hardware initialisation
procedures. Here are hardware initialisation functions:</p>
<div class="highlight"><pre><span></span><code>void SystemClock_Config(void);
static void MX_GPIO_Init(void);
static void MX_RNG_Init(void);
static void MX_RTC_Init(void);
static void MX_USART2_UART_Init(void);
</code></pre></div>
<p>These functions can be generated by "STM32CubeMX" software for different MCU
model from STM32 family.</p>
<p>Remaining code files in this catalog are related to USB CDC device and could be
removed after going on SPI or LPC protocol.</p>
<p>Catalog "startup" is generated automaticaly during creating new project by
"STM32CubeMX".</p>
<p>Catalog "Inc" contains header files for major code files in project:</p>
<ul>
<li>stm32l4xx_it.h</li>
<li>stm32l4xx_hal_conf.h</li>
<li>main.h</li>
</ul>
<p>These files can be generated by "STM32CubeMX" software for different MCU
model from STM32 family. There also are located header files for USB device,
which could be removed removed after going on SPI or LPC protocol. In sub-catalogs</p>
<ul>
<li>Platform</li>
<li>TPMCmd</li>
<li>TPMDevice</li>
</ul>
<p>there are located header files related to reference implementation of TPM
(Microsoft) - these files are not dependent of hardware.</p>
<p>In "Drivers" catalog are located basic hardware layer drivers:</p>
<ul>
<li>CMSIS</li>
<li>STM32L4xx_HAL_Driver</li>
</ul>
<p>These catalogs are automaticaly copied to project during creating of project.
In the case of choosing of different MCU (not STM32 family) the CMSIS drivers also
would be copied to project, but HAL library can be quite different.</p>
<p>“Middlewares” catalog includes major implementation of TPM (Microsoft company)
and also implemantation of USB device. USB library code is located in:</p>
<ul>
<li>ST → STM32_USB_Device_Library</li>
</ul>
<p>TPM implementation is located in sub-catalogs:</p>
<ul>
<li>Platform</li>
<li>TPMCmd</li>
<li>TPMDevice</li>
<li>wolfcrypt</li>
</ul>
<p>TPM implementation is independent from hardware.</p>
<p>"Includes" catalod includes headers related to CMSIS library, HAL library, USB
device and TPM. This code is related of hardware and might be most difficult to
write for different MCU.</p>
<h2 id="target-hardware-platform-for-tpm-arm-project">Target hardware platform for TPM (ARM) project</h2>
<p>The major difficulty for choosing new hardware platform (MCU) is current
unavailability of semiconductors, so the major criterion is availability of
particular MCU. New MCU have to let overcome issues described in the beginning of
this document. In this purpose we made such assumptiuons for new MCU:</p>
<ul>
<li>MCU : ARM-Cortex-M4</li>
<li>clock frequency from 168 Mhz to 200 Mhz</li>
<li>LQFP64 case</li>
<li>SRAM amount from 192 KB to 256 KB</li>
</ul>
<p>We choose device with ARM Cortex-M4 from "GigaDevice" company. Here is link to
search engine on "Gigadevice" WWW page:</p>
<p><a href="https://www.gigadevice.com/products/microcontrollers/gd32/arm-cortex-m4/high-performance-line/?fwp_processor_type=cortex-m4&amp;fwp_microcontrollers_product_line=high-performance&amp;fwp_sram_memory=192k%2C256k&amp;fwp_io_pins=51.00%2C69.00">High performance GD32 ARM Cirtex-M4 Microcontrollers</a></p>
<p>The best candidate for new MCU seems this particular device:</p>
<p><a href="https://www.gigadevice.com/microcontroller/gd32f425rgt6/">GD32F425RGT6</a></p>
<p>The "GigaDevice" company also provides basic firmware: CMSIS library and few tools
(for example programer, profiler). The reference IDE/Compiler for these GD32 MCU
is "Keil uVision" ("Segger Studio for ARM" is also on list). There is also hardware
programmer/debugger (JTAG) available.</p>
<p>There is one difficulty with this GD32F4xx MCU family, there is not available "HAL"
library for these devices. "Gigadevice" company id providing instead "HAL" libraries
"Standard Peripheral" libray. "Standard Peripheral" libray was higher-level hardware
abstraction library, before ST company write newer "HAL" library. "Standard Peripheral"
library is from several years deprecated and what worse it's API is different from "HAL"
API. This fact has impact on time estitmate for re-writing code for new MCU - all
hardware dependent code have to be re-writing. So time estimates will be higher.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>